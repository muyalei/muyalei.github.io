iptables使用的是封包过滤(ip filter)的防火墙策略机制，另一种防火墙机制是使用代理服务器(proxy)；
chain：链，包括filter、nat、mangle及用户自定义；
tables：包括INPUT、OUTPUT、FORWARD(封包转递)；
如本机防火墙(filter)下的进入本机的防火墙策略表(INPUT)中的某条具体策略；
filter：本机防火墙；
防火墙策略顺序：由于封包被一条匹配的规则处理后，就不再往下走由其他规则处理，所有防火墙策略添加时，要注意顺序问题，如先写需要
屏蔽的某条特殊防火墙策略，后写可以放开的可进入本机的封包范围。

防火墙的查看：
iptables -t filter -L -nv  查看本机(filter)防火墙策略，-t参数指定table类型 本机filter、后端nat或mangle，不加-t默认filter；
-n 不进行ip与hostname的反查；
-v 显示统计数据；

清除本机防火墙策略：
iptables -t tables -F/X/Z
清除本机(filter)防火墙策略，3步逐步进行；
iptables -F，清除所有已经定制的防火墙规则；
iptables -X，kill所有用户自定tables；
iptables -Z，将所有chain的计数与流量统计清零；

防火墙默认策略policy设定：
iptables -P INPUT/OUTPUT/FORWARD  ACCEPT/DROP ，不加-t参数指定chain，默认对filter进行设定；
当前面的策略都不符合该封包中相关参数时，实行默认策略动作。

封包的基础过滤：
iptables -A/I tables(INPUT或OUTPUT) -i/o ethx -p 协议 -s 来源ip/网段 -d 目标ip/网段 -j ACCEPT/DROP/LOG
tables指本机的INPUT、OUTPUT表；
-A tables ，在本机的对应table最后，加上一条防火墙策略；
-I tables，将防火墙策略加在最前；
-i ethx，针对从该接口进入本机的封包进行过滤，与tables的INPUT表对应；
-o ethx，从本机出去的封包；
-p 协议，包括tcp、udp、icmp及all；
-s 来源，网段表示方法，192.168.1.0/24、192.168.1.0/255.255.255.0都可以；
-j 动作，使用LOG动作时，记录信息写在/var/log/messages中；
tcp、udp封包过滤：
iptables -A/I tables -i/o ethx -p tcp/udp -s 来源ip/网段 --sport 端口或范围 -d 目标主机/网段 --dport 端口或范围 -j ACCEPT/DROP
其中，端口范围的 ： 表示连续，如1000:2222表示1000到2222的所有端口；
根据封包状态进行过滤：
iptables -A INPUT -m state --state 状态 ，针对想要进入本机的封包状态进行过滤；
状态：RELATED、ESTABLISHED 分别表示与本机发出去的封包相关的封包、已经与本机成功联机的远程主机发送的封包 两种状态；
INVALID，无效封包或称不合法封包；
iptables -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT ，已经联机或与本机发出封包相关的封包允许进入本机；
iptables -A INPUT -m mac --mac-source xx.xx.xx.xx.xx.xx -j ACCEPT，允许来源主机mac地址为此的主机封包进入；

iptables -A INPUT -p icmp --icmp-type 8 -j DROP，禁止icmp type代号是8的icmp封包进入本机，类型代号8表示echo request，该设定
使得外部主机不能通过ping获知本机是否存活，但不影响本机ping命令的使用。

iptables策略保存、恢复：
iptables-save > filename，将防火墙策略保存成指定文件；
iptables-restore < filename，将文件中保存的防火墙策略应用到系统；
将iptables-save结果存成/etc/sysconfig/iptables，并使用chkconfig设置为开机启动，则系统开机主动加载防火墙策略；





手动添加防火墙策略
iptables -A/I 链  -i/o ethx  -p 协议 -s 来源IP或网段  --sport 来源端口  -d 目的IP或网段  --dport 目的端口  -j ACCEPT/DROP/LOG
链chain：INPUT、OUTPUT、FORWARD 3个链，表示针对进入本机的链、从本机发出的链、   3种封包的处理策略
-A：在现有策略最后添加这一条策略
-I：在现有放火墙最前插入这一条策略
-i：针对从该网口进入的封包的处理，与INPUT搭配
-o：针对从该网口出去的封包的处理，与OUTPUT搭配
协议：tcp、udp、icmp或者all
-j：处理动作。ACCEPT 接受该封包，DROP丢弃该封包，LOG记录该封包
--sport：来源端口号，1024：65535表示1024到65535的连续的全部端口号， ： 表示连续。
没有设定的参数表示该参数默认全部接受。
iptables -A INPUT -i eth0 -s 192.168.0.1 -j ACCEPT  添加进入本机的防火墙策略，从接口eth0进来来源IP是192.168.0.1的封包可全部进入
本机。

防火墙的状态模块：
iptables -A INPUT -m state --state RELATED，ESTABLISHED -j ACCEPT  增加进入本机的防火墙策略，--已建立或相关封包都予以放行进入本机
-m：指定iptables模块，包括state、mac两个模块
--state：指定封包状态。	RELATED 与本机发出的封包相关，ESTABLISHED 已经联机成功主机发送的封包，INVALID 数据破损等无效的封包，
NEW 想要新建联机的封包
iptables -A INPUT -m mac --mac-source mac地址 -j ACCEPT  针对局域网，允许某mac地址对应主机连接本机。

icmp封包的过滤
iptables -A INPUT -p icmp --icmp-type  icmp封包类型代号x  -j  ACCEPT/DROP/FORWARD
增加本机的INPUT链（进入本机）的防火墙策略，icmp封包类型代号是x的封包予以接收、丢弃或forward

iptables-save > filename 将本机防火墙策略保存为文件filename
iptables-save生成文件保存成/etc/sysconfig/iptables，使用chkconfig设置iptables开机启动，则/etc/sysconfig/iptables随开机被加载为防火墙策略
iptables-restore < filename 将filename中防火墙策略添加进本机当前防火墙策略









































