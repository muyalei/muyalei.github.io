---
layout: default
author: muyalei
date: 2018-11-05
title: hadoop2.8.1完全分布式环境搭建
tags:
   - hadoop
---

转载自[https://www.cnblogs.com/pcxie/p/7747317.html](https://www.cnblogs.com/pcxie/p/7747317.html)

## 前言
 

本文搭建了一个由三节点（master、slave1、slave2）构成的Hadoop完全分布式集群（区别单节点伪分布式集群），并通过Hadoop分布式计算的一个示例测试集群的正确性。

本文集群三个节点基于三台虚拟机进行搭建，节点安装的操作系统为Centos7（yum源），Hadoop版本选取为2.8.0。作者也是初次搭建Hadoop集群，其间遇到了很多问题，故希望通过该博客让读者避免。


## 实验过程
### 1、基础集群的搭建

目的：获得一个可以互相通信的三节点集群

下载并安装VMware WorkStation Pro（支持快照，方便对集群进行保存）[下载地址](https://my.vmware.com/en/web/vmware/info/slug/desktop_end_user_computing/vmware_workstation_pro/14_0?wd=&eqid=d6c4c03a00010ae30000000359f43c44)，产品激活序列号网上自行查找。

下载CentOS7镜像，[下载地址](http://isoredirect.centos.org/centos/7/isos/x86_64/CentOS-7-x86_64-DVD-1708.iso)。

使用VMware安装master节点（稍后其他两个节点可以通过复制master节点的虚拟机文件创建）。

三个节点存储均为30G默认安装，master节点内存大小为2GB，双核，slave节点内存大小1GB，单核

### 2、集群网络配置

目的：为了使得集群既能互相之间进行通信，又能够进行外网通信，需要为节点添加两张网卡（可以在虚拟机启动的时候另外添加一张网卡，即网络适配器，也可以在节点创建之后，在VMware设置中添加）。

两张网卡上网方式均采用桥接模式，外网IP设置为自动获取（通过此网卡进行外网访问，配置应该按照你当前主机的上网方式进行合理配置，如果不与主机通信的话可以采用NAT上网方式，这样选取默认配置就行），内网IP设置为静态IP。

本文中的集群网络环境配置如下:

master内网IP：192.168.1.100

slave1内网IP：192.168.1.101

slave2内网IP：192.168.1.102

![2018-11-05-hadoop2.8.1完全分布式环境搭建_图片1.jpg]()

设置完后，可以通过ping进行网络测试

注意事项：通过虚拟机文件复制，在VMware改名快速创建slave1和slave2后，可能会产生网卡MAC地址重复的问题，需要在VMware网卡设置中重新生成MAC，在虚拟机复制后需要更改内网网卡的IP。

每次虚拟机重启后，网卡可能没有自动启动，需要手动重新连接。

### 3、集群SSH免密登陆设置

目的：创建一个可以ssh免密登陆的集群

#### 3.1　　创建hadoop用户

为三个节点分别创建相同的用户hadoop，并在以后的操作均在此用户下操作，操作如下：
```
$su -

#useradd -m hadoop

#passwd hadoop

为hadoop添加sudo权限

#visudo

在该行root ALL=(ALL) ALL下添加hadoop ALL=(ALL) ALL保存后退出，并切换回hadoop用户

#su hadoop
```
注意事项：三个节点的用户名必须相同，不然以后会对后面ssh及hadoop集群搭建产生巨大影响

#### 3.2　　hosts文件设置
为了不直接使用IP，可以通过设置hosts文件达到ssh  slave1这样的的效果（三个节点设置相同）

$sudo vim /etc/hosts

在文件尾部添加如下行，保存后退出：

192.168.1.100　　master

192.168.1.101　　slave1

192.168.1.102　　slave2

![2018-11-05-hadoop2.8.1完全分布式环境搭建_图片2]()

注意事项：不要在127.0.0.1后面添加主机名，如果加了master，会造成后面hadoop的一个很坑的问题，在slave节点应该解析出masterIP的时候解析出127.0.0.1，造成hadoop搭建完全正确，但是系统显示可用节点一直为0。


#### 3.3　　hostname修改

centos7默认的hostname是localhost，为了方便将每个节点hostname分别修改为master、slave1、slave2（以下以master节点为例）。

$sudo hostnamectl set-hostname master

重启terminal，然后查看：$hostname

![2018-11-05-hadoop2.8.1完全分布式环境搭建_图片3]()


#### 3.4　　ssh设置

设置master节点和两个slave节点之间的双向ssh免密通信，下面以master节点ssh免密登陆slave节点设置为例，进行ssh设置介绍（以下操作均在master机器上操作）：

首先生成master的rsa密钥：$ssh-keygen -t rsa 

设置全部采用默认值进行回车

将生成的rsa追加写入授权文件：$cat ~/.ssh/id_rsa.pub >> ~/.ssh/authorized_keys

给授权文件权限：$chmod 600  ~/.ssh/authorized_keys

进行本机ssh测试：$ssh maste r正常免密登陆后所有的ssh第一次都需要密码，此后都不需要密码

将master上的authorized_keys传到slave1

sudo scp ~/.ssh/id_rsa.pub hadoop@slave1:~/   

登陆到slave1操作：$ssh slave1输入密码登陆  

$cat ~/id_rsa.pub >> ~/.ssh/authorized_keys

修改authorized_keys权限：$chmod 600  ~/.ssh/authorized_keys

退出slave1：$exit

进行免密ssh登陆测试：$ssh slave1

![2018-11-05-hadoop2.8.1完全分布式环境搭建_图片4.png]()

注意事项：slave1、slave2下也要执行 `ssh-keygen -t rsa`命令，才可以实现免密登录。（原文没说说清）
