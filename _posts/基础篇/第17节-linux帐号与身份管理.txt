/etc/passwd 记录用户名信息
用户名：x：uid：gid（即初始群组）：用户信息详述：使用的shell
/etc/shadow 记录用户名对应密码
用户名：加密后密码：uid：gid：最后一次更改密码时间：密码不可变动时间：密码保存周期：密码需要变更前的告警期限：恕限时间：密码失效时间：保留
注：第二栏为*或者！时该账号不能登陆系统。同理，passwd -l username 锁住用户使之不能登陆，-u 解锁该用户。

/etc/group 记录群组信息
群组名称：x:gid：该群组所属用户
/etc/gshadow 群组密码
群组名称：密码：群组管理员（可以使用gpasswd设置）：该群组所属用户
有效群组即当前用户所在的群组。初始群组指随新建用户建立的群组，用户登入系统默认进入该群组。使用groups查看当前用户所属群组有哪些，使用newgrp
切换当前用户所属的有效群组。

passwd 修改自己的密码。对于root权限用户可以使用 passwd username 修改他人密码 

useradd username 参考系统默认值，添加用户 。 root权限才能使用
useradd -m -u 1111 -g grouptest username 添加用户username，强制建立家目录，指定uid为1111，指定初始群组为grouptest（已在系统中存在）
userdel username 删除用户（涉及文件/etc/passwd、/etc/shadow）。-r 家目录一同删除。 root权限才能使用

chsh 普通用户修改自身shell。-l 读取/etc/shells文件，查看可用shell，-s 设定自身shell。
chfn 修改/etc/passwd第5栏信息。

finger -s username 查看用户信息。
id username 查看用户uid、gid、所属群组。

groupadd groupname 新增用户组。groupadd -g  1111 grouptest 指定新用户组的gid为1111 。-r 建立系统群组。
groupdel groupname 删除用户组。当群组为系统中某用户的初始群组（inital_group），不能删除。
gpasswd groupname 修改群组密码。-r 清空群组密码；-R 将/etc/gshadow中对应群组的第二栏变成！。
gpasswd -A user1 -M user1，user2 grouptest 将user1、user2加入群组grouptest，并且指定user1为该群组的管理员。当前用户为user1时，
gpasswd -a/d user3 grouptest 将user3加入该群组/从该组删除。

su - 切换到root，且使用root的环境设定；使用su root ，切换后为root权限，但仍然是用切换前用户环境；env查看当前用户环境。
su -l username 切换到用户username，且使用username的环境设定。带-l参数。
sudo 使用root权限执行某一操作。-u 使用某用户执行操作。
使用visudo编辑/etc/sudoers文件，在文件中写入 yaya ALL = （ALL） ALL， （用户 登陆主机 = 可切换成的账户 可执行的命令），yaya即可使用sudo命令，
（ALL） NOPASSWD: ALL 表示使用sudo不用输入密码，没有（ALL）只能切换成root。可以使用 “指代名”，必须大写，如User_Alias AAA=user1，user2，user3
AAA ALL = ALL  ，User_Alias 设定用户代别名，设定命令别名用Cmnd_Alias=commond1,commond2。用户栏前带有%表示群组，表示对群组设定sudo


PAM模块，用于验证
用于验证的设定文件存放在/etc/pam.d/* ，如使用passwd设定密码的验证文件是/etc/pam.d/passwd，该文件中列出该程序
使用时验证的内容、验证通过的标准及验证使用的模块，仅仅是模块，模块具体文件内容存放在/lib/security/*；
/etc/security/* 存放环境验证文件。如limits.conf，限制某一用户/用户组可使用的资源量，username hard fsize 1024（单位kb） 

/sbin/nologin、/etc/nologin.txt、/etc/nologin文件
/sbin/nologin 用于系统账户，可以正常使用系统资源但是不能用于登陆系统，/etc/nologin.txt文件中记录登陆失败时的
提示信息。
/etc/nologin 文件若存在，则除root外其他普通用户都不能登陆系统，错误提示信息为/etc/nologin文件内容。针对普通用户。
/etc/security 针对root用户的安全验证。限定root用户只能通过tty1..登陆而不能通过telnet等网络接口登陆，去掉
/etc/pam.d/login文件中的security验证模块即可使用telnet登陆。


/etc/shells 下记录了当前系统可用的shell，/sbin/nologin这个shell可以使账号正常使用系统资源，但无法用于登陆系统，
用于系统账号，/etc/nologin.txt文件内容为登陆失败时的提示内容。

系统日志存放位置 /var/log/messages、/var/log/secure

w/who 查看当前在线用户；
last 查看近1个月内登陆的用户；
lastlog 根据/var/log/lastlog内容显示每个用户的最后登录系统时间。





系统并不认识账户名称，只认识登录者的uid、gid，当系统查询某一档案时，会依据/etc/passwd中的内容将档案的uid、gid以账户
名称的形式显示出来；


/etc/passwd、/etc/shadow 管理使用者帐号

/etc/passwd 文件内容
root:x:0:0:root:/root:/bin/bash
root为帐号名称；
x为该帐号的密码，现在已经将密码放在/etc/shadow文件下
0 为该帐号的uid，0表示为系统管理员帐号，1-499为系统帐号，>=500为一般使用者帐号；
0 为gid帐号；
root 该项为使用者信息说明栏，解释这个帐号的用途，没用；
/root 家目录位置；root用户的家目录是/root，普通用户为/home/账户名
/bin/bash 使用的shell；/sbin/nologin 这个shell可以让帐号无法登录，可以用来制作纯pop邮件账号者；


/etc/shadow 文件内容，这个文件只用root用户才有读取、写入权限
root:$1$i9Ejldjfjio389u9sjl$jljsoi45QE/:12959:0:99999:7:1:2:3
root  ：帐号名称
第二栏：加密过的密码，在该栏前加一个 * 或者 ! ，表示这个帐号不会被用来登录；
12959 ：最近更改密码的日期，距离19700101的天数；
   0  ：密码不可被更改的天数，在设定的天数内该用户不能更改该帐号的密码
9999  ：密码变更周期，即相隔一段时间强制帐户使用者更改密码，99999表示不需要更改密码；
  7   ：密码需要变更期限前的警告期限，天数，为密码变更周期服务；
  1   ：密码过期恕限时间，即密码过期后在该天数内仍可使用，过了这个时间密码失效；
  2   ：帐号失效日期，该密码在该设定日期后失效，与前三个字段一样，都是使用1970年以来的总日数设定；
  3   ：保留，为日后新功能加入预留
  

群组：初始群组/有效群组，groups，newgrp   

/etc/group
格式：bin：x：1：root，bin，daemon（群组名称：群组密码：GID：群组包含的用户）

初始群组（initial group）与有效群组（effective group）
初始群组是随用户账号建立产生的群组，与用户名相同，用户登录主机即取得该群组的相关权限；将用户加到
某一群组第四栏，群组即包含该用户，使用newgrp切换当前有效群组（用户属于该群组才能切换），exit退出新
的有效群组；使用groups查看当前用户支持的群组，第一个群组即为有效群组；

/etc/gshadow
格式：bin：：：root，bin，daemon（群组名称：密码（！开头表示不能登陆）：群组管理员账号：该群组所属账号）


新增与删除用户：useradd，passwd，usermod，userdel 除passwd，都是root才能使用的命令

useradd muyalei   添加新用户muyalei；useradd参考如下文件对新用户进行预设：useradd命令参考/etc/default/useradd文
                  件对新建用户进行预设定；/etc/skel/* 新建用户的家目录中内容由该文件复制过去；新建用户的UID/GID预设定文件
                  在/etc/login.defs；-m 强制建立家目录，-g 指定初始群组。
passwd muyalei    为muyalei设定密码，普通用户新建用户密码需要符合系统的密码验证要求，root用户随意；
                  验证机制位于/etc/login.defs  /etc/pam.d/passwd 这两个文件；
usermod           root用户对用户信息进行调整；    
userdel muyalei   删除用户；-r 参数，同时删除用户家目录；该命令是完全删除用户，如果想要保留用户信息，只是让该
                  用户暂时无法登陆，可在/etc/shadow最后一栏加 0 ；

一般使用者改变自身账号数据命令：chsh  chfn
chsh  参数： -l 列出系统上可用的shell，即/etc/shells文件；-s 设定自身的shell；
chfn  参数：-f 更改用户名；该命令改变的是/etc/passwd中第五栏，用户详细介绍的内容；

finger username 查询用户信息；这个工具需要手动安装
id username  查询用户的UID/GID等信息；

群组管理：groupadd  groupmod  groupdel  gpasswd
groupadd groupname  参数：-g 指定GID；-r 建立系统群组；gpasswd指定群组密码后，该群组才能加入其他用户，否则为私有群组；
groupmod 参数：-g 修改GID；-n 修改群组名称；例：groupmod -g 888 -n muyalei grouptest
groupdel groupname  删除群组；

gpasswd  参数：不加参数，表示给予后接群组一个密码（/etc/gshadow）；-A 将群组管理权限交给后接的用户；-M 将用户加入群组，以逗号分隔不同用户；
         -r 去除群组密码；-R 使/etc/gshadow密码栏失效，用户不能使用newgrp切换有效群组；
         例：gpasswd -A muyalei -M aya，ahua，enen  grouptest     设置muyalei为群组grouptest的管理员，将aya/ahua/enen拉进该群组；
         对于muyalei的权限，参数：-a 将用户加入群组；-d 将用户从该群组删除；对于用户muyalei，gpasswd  -a xiaoxiao  grouptest 把
         用户xiaoxiao加入群组；
 

用户身份切换：su  sudo

su    参数：不加参数，表示切换到root，但使用切换前的环境设定；su - ，切换到root且使用root的环境设定；su -l yaya 切换到yaya且使用
      yaya的环境设定；-c 仅进行一次指令，-c后可以接指令；使用exit离开su回到原使用者

sudo  以root的权限执行命令。参数：-u，su -u username（或#uid）。用户在/etc/sudoers文件中存在，才具有sudo命令的执行权限，使用visudo命令编辑/etc/sudoers。
      例：sudo -u username mkdir /etc/test  普通用户使用username账户权限建立/etc/test，sudo ls -lnr /etc/passwd 普通用户使用root权限
      查看/etc/passwd文件，前提是用户有执行sudo的权限。
visudo编辑/etc/sudoers文件，只有root才有执行权限；如，将muyalei添加sudo权限：使用visudo打开/etc/sudoers文件，增加行 
      muyalei ALL=(ALL) ALL （含义：使用者账号  登入的主机=（可以变换的身份） 可以下达的指令）即可，没有（ALL）项表示只能切换到root权限；使用者账号为%groupname 表示
      群组groupname中的用户都具有dudo权限；%groupname ALL=(ALL) NOPASSWD: ALL 表示在该群组中的用户执行sudo命令不需要输入密码；

/etc/sudoers中使用别名进行套用，别名必须为大写，
如：User_Alias AABB = vbird,mumu,yaya,huangha   AABB ALL = NOPASSWD：!/user/bin/passwd,/user/bin/passwd[A-Za-z]*,!/user/bin/passwd root ,
表示群组中的用户可以更改用户密码，但是不能更改root密码，没有/etc/passwd权限；再如：
User_Alias DNSMASTER = vbird,dmtsai
Cmnd_Alias DNSCMD =/etc/init.d/named,/usr/bin/vim,/var/named/*     使用which 查找vim命令路径
DNSMASTER ALL = DNSCMD
DNSMASTER代指的用户可以切换到root执行DNSCMD代指的命令。

sudo命令只能执行一条指令，与su命令结合，可以使普通用户取得root权限，切不用泄露root密码，如：AABB ALL = /bin/su ，sudo su - ，即切换到root；

特殊的shell： /sbin/nologin  /etc/passwd文件将最后一栏shell写成/sbin/nologin表示该账号不能登陆主机，/etc/nologin.txt文件中给出不能登陆的原因。


PAM模块（嵌入式模块）：被程序调用，当被程序调用时就会根据相应的设定文件进行验证。
设定文件放置在/etc/pam.d目录中，环境相关设定放置在/etc/security/*，验证模块放置在/lib/security/*内；



查询使用者：w,who,last,lastlog
w/who/finger username  查询用户相关信息；
last 列出本月登入主机的用户；
lastlog 读取/var/log/lastlog文件，查询每个账号最近登入的时

与主机上的其他用户交谈：talk，write，mesg，wall  限于用户在线
使用talk直接与某一用户交谈，需要启动某些网络服务；
使用write给某一个用户发信息，write yaya，enter执行命令，输入内容后ctrl+D；wall给系统上的所有在线使用者传送信息；用户可以使用
mesg n 命令拒绝接收其他用户发送信息，使用mesg y 开启接收；  


邮件系统：mail
用户mailbox路径/var/spool/mail/username；
寄信：mail username@localhost -s "邮件标题" ，enter确认，即可输入信件内容，末句另起一行，以点号"."作为输入结束标志，"Cc:"填写
需要抄送的人，没有直接enter完成；可以预先编辑好信件内容，使用数据流重导向导入，mail username@localhost -s "邮件标题" < filename
收信：直接输入mail即可。mail下提示符为&，输入？查询mail中指令。
常用指令：h ，列出信件标题，h40 查阅40封信件的标题；
d 删除，d10删除第十封信件，d10-30删除10-30封信件；
s 将信件保存成为文件，如将第3封邮件保存成文件 s 5 ~/mail.file；
x 或者 exit 不做任何动作离开mail，删除的信件复原；
q 保存动作后退出mail，包括将删除的邮件移出mailbox，将阅读过的信件保存进 ~/mbox；


不使用useradd/passwd命令，手动添加主机用户：
1. 先建立所需要的群组 ( vi /etc/group )； 
2. 将 /etc/group 与 /etc/gshadow 同步化 ( grpconv )；  
3. 建立账号的各个属性 ( vi /etc/passwd )；  
4. 将 /etc/passwd 与 /etc/shadow 同步化 ( pwconv )；  
5. 建立该账号的密码 ( passwd accountname )；  
6. 建立使用者家目录 ( cp -a /etc/skel /home/accountname )；  
7. 更改使用者家目录的属性 ( chown -R accountname.group /home/accountname )。 

pwck  pwconv pwuconv grpconv grpuconv 检查工具
pwck：检查/etc/passwd  /etc/shadow信息是否一致，检查/etc/passwd中家目录是否存在；
pwconv：将/etc/passwd中的账号与密码移动到/etc/shadow中。比对后，若passwd中的账号在shadow中没有对应，则pwconv去/etc/login.defs
        取用相关数据。
pwuconv：将/etc/shadow中数据写回/etc/passwd并删除/etc/shadow文件。
chpasswd：读入未加密前的数据，加密后写入/etc/shadow。每笔数据的格式 username：password 。可以读入STDIN。默认使用DES加密，参数 -m
          表示使用MD5加密。如：echo "muyalei:123457" | chpasswd   





















































