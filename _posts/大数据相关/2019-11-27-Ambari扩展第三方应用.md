---
layout: default
author: muyalei
title: Ambari扩展第三方应用
date: 2019-11-27
tags:
    - 大数据
---


***鄙人原创，转载请注明出处***


***参考：***

[]()
[]()
[]()


## 简介

Ambari管理内置应用有一套标准的流程模版，只需要按照这个流程，将自己的第三方应用做相应配置，Ambari即可像管理内置应用一样管理添加的第三方应用。

将下载的ambari-server安装文件解压后，可以在下面路径找到Ambari所有的内置应用设置文件：`/var/www/html/ambari/centos7/2.7.0.0-897/tars/ambari/ambari-3.0.0.0.2.7.0.0-897/ambari-server/src/main/resources/stacks/HDP/2.6/services`(我是解压到了/var/www/html/ambari目录下)，每个应用下面都有很多设置文件，metainfo.xml、package、configuration这三个是一定存在的。

metainfo.xml是告诉Ambari服务，这个应用名字是什么，有哪些组件，部署每个组件对应的加载脚本名称、位置，部署这个应用前操作系统需要安装哪些东西，依赖的配置文件等描述信息；package/scripts目录下存放加载应用的脚本、读取配置文件的params.py等；configuration是配置文件，存放这个应用需要用户在web界面上配置的信息。 

下面会以扩展Flink作为实例。


## metainfo.xml

实例：

<?xml version="1.0"?>
`<metainfo> #为了正常显示，这里加了一个 ` ，正常配置时要把这个 ` 去掉
    <schemaVersion>2.0</schemaVersion>
    <services>
        <service> #要扩展的第三方服务描述信息，在web界面点击`add service`时，显示的服务信息就是这个标签设置的
            <name>FLINK</name> 
            <displayName>Flink</displayName>
            <comment>balabalamuyalei</comment>
            <version>1.9.1</version>
            <components>
                <component> #这个服务包含的组件
                    <name>FLINK_MASTER</name> 
                    <displayName>Flink Master</displayName>
                    <category>MASTER</category> #这个标签，只有MASTER、SLAVE、CLIENT三个值，一定要大写
                    <cardinality>1</cardinality> #组件数量
                    <timelineAppid>FLINK</timelineAppid>
                    <versionAdvertised>true</versionAdvertised>
                    <commandScript>
                        <script>scripts/flink_master.py</script> #Ambari管理这个服务的控制脚本（完成install、start、stop、status、configure这些生命周期）
                        <scriptType>PYTHON</scriptType>
                        <timeout>1200</timeout>
                    </commandScript>
                    <logs>
                        <log>
                            <logId>flink-master</logId>
                            <primary>true</primary>
                        </log>
                    </logs>
                </component>
                <component>
                    <name>FLINK_SLAVE</name>
                    <displayName>Flink Slave</displayName>
                    <category>SLAVE</category>
                    <cardinality>0+</cardinality>
                    <timelineAppid>FLINK</timelineAppid>
                    <versionAdvertised>true</versionAdvertised>
                    <commandScript>
                        <script>scripts/flink_slave.py</script>
                        <scriptType>PYTHON</scriptType>
                        <timeout>1200</timeout>
                    </commandScript>
                    <logs>
                        <log>
                            <logId>flink-slave</logId>
                            <primary>true</primary>
                        </log>
                    </logs>
                </component> 
            </components>
            <osSpecifics>
                <osSpecific>
                    <osFamily>any</osFamily> #所支持的操作系统
                    <packages>
                        <package> #这个服务的依赖，比如下面的wget，部署这个应用前，Ambari会通过yum或者apt-get安装所有这些依赖
                            <name>gcc</name>
                        </package>
                        <package>
                            <name>wget</name>
                        </package>
                    </packages>
                </osSpecific>
            </osSpecifics>
            <!--
            <commandScript> #服务检查的脚本实现
                <script>scripts/service_check.py</script> 
                <scriptType>PYTHON</scriptType>
                <timeout>300</timeout>
            </commandScript>
            -->            
           <!-- 
            <configuration-dependencies> #这个应用依赖的配置文件，写在这里后，当这些配置文件内容改变，web界面会提示重启该服务。这里空着也没事。
                <config-type>flink-env</config-type>
                <config-type>config-sh</config-type>  
                <config-type>flink-conf-yaml</config-type>  
            </configuration-dependencies>
            -->

            #这两个是Ambari提供的为扩展的第三方应用能使用`AMS`系统而提供的两个基础配置文件
            <!--<metricsFileName>metrics.json</metricsFileName>-->
            <!--<widgetsFileName>widgets.json</widgetsFileName>-->
           

            <restartRequiredAfterChange>true</restartRequiredAfterChange>  #修改配置后是否重启（一般都为true）

            <!--<quickLinksConfigurations>-->
                <!--<quickLinksConfiguration>-->
                    <!--<fileName>quicklinks.json</fileName>-->
                    <!--<default>true</default>-->
                <!--</quickLinksConfiguration>-->
            <!--</quickLinksConfigurations>-->

        </service>
    </services>
`</metainfo>  #为了正常显示，这里加了一个 \` ，正常配置时要把这个 \` 去掉  


###  几个重要的标签及其参数：

1、category：描述组件是主服务、节点从服务或是客户端。

| category类别 | 默认生命周期命令实现 |
| :------: | :------: | 
| MASTER  | install, start, stop, configure, status |
| SLAVE  | install, start, stop, configure, status |
| CLIENT  | install, configure, status |

2、cardinality：描述组件的数量限制。

| cardinality格式 | 格式说明举例 |
| :------: | :------: | 
| 数字 | <cardinality>1</cardinality>：表示只能有一个 |
| 数字区间 | <cardinality>0-1</cardinality>：表示最少有零个，最多有一个 |
| 数字单增区间 | <cardinality>1+</cardinality>：表示最少有1个 |
| ALL | <cardinality>ALL</cardinality>：表示所有节点都需要 |

3、commandScript：组件生命周期命令的执行脚本实现。（除install、start、stop、status、configure这几个基本声明周期命令外的命令。）

其它参数：

请参考：[官方说明](https://cwiki.apache.org/confluence/display/AMBARI/Writing+metainfo.xml)（[中文翻译](https://blog.csdn.net/WangPing1223/article/details/77499098)）








