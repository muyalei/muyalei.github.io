---
layout: default
author: muyalei
title: Flink集群部署
date: 2019-12-05
tags:
    - 大数据
---


***整理自[https://cloud.tencent.com/developer/article/1399121](https://cloud.tencent.com/developer/article/1399121)***


Standalone部署

上一节我们讲了单机模式如何部署启动，这节我们基于CentOS 7虚拟机搭建一个3个节点的集群：

角色分配： 
```
Master: 192.168.246.134
Slave: 192.168.246.135
Slave: 192.168.246.136

192.168.246.134 jobmanager
192.168.246.135 taskmanager
192.168.246.136 taskmanager
```
假设三台机器都存在：

用户root 密码为123 
```
192.168.246.134 master
192.168.246.135 slave1
192.168.246.136 slave2
```
三台机器首先要做ssh免登，具体方法很简单，可以百度。

下载一个包到本地，这里我选择了1.7.2版本+Hadoop2.8+Scala2.11版本，然后分发到三台机器上：
```
scp flink-1.7.2-bin-hadoop28-scala_2.11.tgz root@192.168.246.13X:~
scp jdk-8u11-linux-x64.tar.gz root@192.168.246.13X:~
```
注意：X代表4、5、6，分发到3台机器

修改解压后目录属主：
```
Chown -R  root:root flink/
Chown -R root:root jdk8/

export JAVA_HOME=/root/jdk8
export JRE_HOME=${JAVA_HOME}/jre
export CLASSPATH=.:${JAVA_HOME}/lib:${JRE_HOME}/lib
export PATH=${JAVA_HOME}/bin:$PATH
```
分别修改master和slave的flink-conf.yaml文件 
```
Vim flink/conf/flink-conf.yaml
```
```
##配置master节点ip
jobmanager.rpc.address: 192.168.1.100

##配置slave节点可用内存，单位MB
taskmanager.heap.mb: 25600

##配置每个节点的可用slot，1 核CPU对应 1 slot
##the number of available CPUs per machine 
taskmanager.numberOfTaskSlots: 30
d
##默认并行度 1 slot资源
parallelism.default: 1

修改slave节点配置文件slaves：
192.168.246.135
192.168.246.136
```

启动集群： 
```
##在master节点上执行此脚本，就可以启动集群，前提要保证master节点到slaver节点可以免密登录，
##因为它的启动过程是：先在master节点启动jobmanager进程，然后ssh到各slaver节点启动taskmanager进程
./bin/start-cluster.sh
停止集群：
./bin/stop-cluster.sh
```

详细内容参考文章开头的链接。


